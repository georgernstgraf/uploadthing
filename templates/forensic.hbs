{{#if is_full}}{{> top}}{{/if}}
<div x-data="endTimeToggle()"
     x-init="init()">
     <section id="timeselector"
               class="leisure-card mb-2 mx-auto py-2"
               style="max-width: 800px;">
        <h2 class="text-center mb-2" style="font-size: 1.1rem;">Zeitauswahl</h2>
        <form action="forensic"
              method="get"
              class="container text-center"
              @submit="handleSubmit">
            <datalist id="spg_times_list">
                {{#each spg_times}}
                    <option value="{{this}}"></option>
                {{/each}}
            </datalist>
            <div class="row mt-1 g-2 align-items-center">
                <div class="col-md-6">
                    <label class="form-label fw-bold text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.05em;">
                        START Time
                        <input type="text"
                               name="starttime"
                               class="form-control form-control-sm text-center"
                               id="timestartselect"
                               list="spg_times_list"
                               value="{{starttime}}">
                    </label>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.05em;">
                        Start Date
                        <input type="date"
                               name="startdate"
                               class="form-control form-control-sm text-center"
                               value="{{startdate}}">
                    </label>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col text-center">
                    <div class="form-check form-switch d-inline-flex align-items-center gap-2 p-2" style="font-size: 0.85rem; background: rgba(255,255,255,0.9); border: 2px solid var(--lego-grey); border-radius: var(--lego-radius-brick);">
                        <input class="form-check-input m-0"
                               type="checkbox"
                               id="toggleEndTime"
                               x-model="showEndTime"
                               @change="savePreference()"
                               style="cursor: pointer;">
                        <label class="form-check-label fw-bold m-0"
                               for="toggleEndTime"
                               style="cursor: pointer;">Endzeit festlegen</label>
                    </div>
                </div>
            </div>
            <div class="row mt-2 g-2 align-items-center"
                 x-show="showEndTime"
                 x-transition
                 x-cloak>
                <div class="col-md-6">
                    <label class="form-label fw-bold text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.05em;">
                        End Time
                        <input type="text"
                               name="endtime"
                               class="form-control form-control-sm text-center"
                               id="timeendselect"
                               list="spg_times_list"
                               value="{{endtime}}">
                    </label>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.05em;">
                        End Date
                        <input type="date"
                               name="enddate"
                               class="form-control form-control-sm text-center"
                               value="{{enddate}}">
                    </label>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col">
                    <input type="submit"
                           class="btn btn-primary w-100 py-1"
                           style="font-size: 0.9rem;"
                           value="Suchen">
                </div>
            </div>
        </form>
    </section>
    <script>
        function endTimeToggle() {
            return {
                showEndTime: false,
                endFields: ["endtime", "enddate"],

                init() {
                    const saved = localStorage.getItem('forensicShowEndTime');
                    this.showEndTime = saved === 'true';

                    if (saved === null) {
                        this.showEndTime = false;
                    }

                    if (!this.showEndTime) {
                        this.disableEndFields();
                    }

                },

                savePreference() {
                    localStorage.setItem('forensicShowEndTime', this.showEndTime);
                    if (this.showEndTime) {
                        this.enableEndFields();
                    } else {
                        this.disableEndFields();
                    }
                },

                handleSubmit(event) {
                    if (!this.showEndTime) {
                        this.disableEndFields();
                        return;
                    }

                    const form = event.target;
                    const endtimeInput = form.querySelector('[name="endtime"]');
                    const enddateInput = form.querySelector('[name="enddate"]');
                    const endtimeValue = endtimeInput ? endtimeInput.value.trim() : "";
                    const enddateValue = enddateInput ? enddateInput.value.trim() : "";

                    if (!endtimeValue && !enddateValue) {
                        this.disableEndFields();
                    }
                },

                disableEndFields() {
                    this.endFields.forEach((name) => {
                        const input = document.querySelector(`[name="${name}"]`);
                        if (input) {
                            input.disabled = true;
                        }
                    });
                },

                enableEndFields() {
                    this.endFields.forEach((name) => {
                        const input = document.querySelector(`[name="${name}"]`);
                        if (input) {
                            input.disabled = false;
                        }
                    });
                }
            }
        }
    </script>
    {{> forensic-report}}
</div>
{{#if is_full}}
</div>
</main>
</body>

</html>
{{/if}}
