<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>{{page_title}}</title>
    <link rel="icon"
          type="image/svg+xml"
          href="/static/favicon.svg">
    <link rel="stylesheet"
          href="/static/ibm-plex-sans.css">
    <link rel="stylesheet"
          href="/static/bootstrap.css">
    <link id="theme-css"
          rel="stylesheet"
          href="/static/leisure-theme.css">
    <style>
        [x-cloak] {
            display: none !important;
        }
    </style>
    <script src="/static/htmx.js"></script>
    <script src="/static/bootstrap.js"></script>
    <script src="/static/alpine.min.js"
            defer></script>
</head>

<body>
    <header class="position-fixed top-0 start-0 end-0 app-header"
            style="z-index: 1000;">
        <div class="position-relative mx-2 mt-2">
            <div class="leisure-card py-1 d-flex align-items-center gap-2 header-bar"
                 style="border-radius: 16px;">
                <button class="btn btn-sm btn-outline-secondary rounded-pill px-3 theme-toggle-btn header-spacer"
                        type="button"
                        aria-hidden="true"
                        tabindex="-1"
                        disabled> Theme </button>
                <a class="mb-0 text-center fw-bold h1 flex-grow-1 fs-2"
                   href="http://{{page_title}}/">http://{{page_title}}/</a>
                <button id="theme-toggle"
                        class="btn btn-sm btn-outline-secondary rounded-pill px-3 theme-toggle-btn">Theme</button>
            </div>
        </div>
    </header>
    <script>
        (function () {
            // Theme configuration: [themeName, colorMode]
            const themes = [
                ['lego', 'dark'],
                ['lego', 'light'],
                ['leisure', 'dark'],
                ['leisure', 'light']
            ];

            // Get current theme index from localStorage or default to 0
            const savedIndex = localStorage.getItem('themeIndex');
            let currentIndex = savedIndex !== null ? parseInt(savedIndex, 10) : 0;

            // Validate index
            if (currentIndex < 0 || currentIndex >= themes.length) {
                currentIndex = 0;
            }

            // Apply theme function
            function applyTheme(index) {
                const [themeName, colorMode] = themes[index];
                const themeCss = document.getElementById('theme-css');

                // Update CSS file
                themeCss.href = `/static/${themeName}-theme.css`;

                // Update data-bs-theme for dark mode
                document.documentElement.setAttribute('data-bs-theme', colorMode);

                // Update body class for CSS targeting
                document.body.classList.remove('theme-leisure', 'theme-lego');
                document.body.classList.add(`theme-${themeName}`);
            }

            // Apply initial theme
            applyTheme(currentIndex);

            window.addEventListener('load', () => {
                const toggleBtn = document.getElementById('theme-toggle');
                toggleBtn.addEventListener('click', () => {
                    // Cycle to next theme
                    currentIndex = (currentIndex + 1) % themes.length;
                    applyTheme(currentIndex);
                    localStorage.setItem('themeIndex', currentIndex);
                });
            });
        })();
    </script>
    <main class="container mt-2 p-2 page-content">
        <nav class="d-flex justify-content-center gap-2 mt-5 mb-2 mx-auto p-1 flex-wrap"
             style="width: fit-content; max-width: 100%; background: var(--leisure-glass-bg); backdrop-filter: blur(10px); border-radius: 50px; border: 1px solid var(--leisure-glass-border); box-shadow: var(--leisure-shadow-soft);">
            <a href="/"
               class="btn btn-sm btn-info text-white border-0 flex-grow-1 flex-sm-grow-0">Home</a>
            {{#if is_admin}}
            <a href="/forensic"
               class="btn btn-sm btn-info text-white border-0 flex-grow-1 flex-sm-grow-0">Forensic</a>
            {{/if}}
            <a href="/upload"
               class="btn btn-sm btn-info text-white border-0 flex-grow-1 flex-sm-grow-0">Zipfile Upload</a>
        </nav>
        <div class="d-flex justify-content-center mb-2">
            <a href="/whoami"
               class="text-decoration-none user-badge p-2 leisure-card w-100"
               style="max-width: 500px; justify-content: center;">
                {{#if remote_user}}
                    <div class="d-flex align-items-center gap-2 justify-content-center flex-wrap text-center text-sm-start">
                        <div class="rounded-circle bg-danger text-white d-flex align-items-center justify-content-center"
                             style="width: 36px; height: 36px; font-size: 1.1rem;">
                            {{givenNameInitial remote_user.name}}
                        </div>
                        <div class="d-flex flex-column text-dark">
                            <span class="fw-bold text-break"
                                  style="font-size: 0.95rem;">{{remote_user.name}}</span>
                            <span class="text-muted text-break"
                                  style="font-size: 0.75rem;">{{remote_user.email}} / {{remote_user.klasse}}</span>
                        </div>
                        <span class="badge rounded-pill bg-light text-dark border ms-1"
                              style="font-size: 0.7rem;">Change</span>
                    </div>
                {{else}}
                    <span class="text-danger fw-bold text-decoration-underline text-center d-block"
                          style="font-size: 0.95rem;">Bitte Name bekanntgeben!</span>
                {{/if}}
            </a>
        </div>
        <div class="text-center mb-2 opacity-50">
            <span class="text-uppercase"
                  style="font-size: 0.7rem; letter-spacing: 2px;">Meine IP: {{remote_ip}}</span>
        </div>